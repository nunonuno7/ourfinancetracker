
# ourfinancetracker

A lightweight, self-hostable personal-finance tracker built with **Django 5.2** and a modern JS frontâ€‘end (HTMXÂ + BootstrapÂ 5 + noUiSlider).  
It supports bankâ€‘statement imports, smart filtering, monthly dashboards and (coming soon) scheduling of recurring transactions & automatic FX conversion.

---

## Table of Contents
1. [Quick start](#quick-start)
2. [Core features](#core-features)
3. [Financialâ€‘metric calculations](#financial-metric-calculations)
4. [Data model & taxonomy](#data-model--taxonomy)
5. [CLI / management commands](#cli--management-commands)
6. [Roadmap](#roadmap)
7. [Contributing](#contributing)
8. [Licence](#licence)

---

## Quick start

```bash
git clone https://github.com/nunonuno7/ourfinancetracker.git
cd ourfinancetracker
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver
```

Browse to `http://127.0.0.1:8000/`, log in and start importing statements (`Transactions â†’ Import Excel`) or monthly balances (`Account Balances â†’ Import Excel`).

---

## Core features

| Area                       | Status | Notes |
| -------------------------- | :----: | ----- |
| Transaction CRUD           | âœ…     | Inline form with HTMX; autocomplete for tags & categories |
| Excel import / export      | âœ…     | `transactions` and `account_balances` both support `.xlsx` |
| Dashboard (`/dashboard/`)  | âœ…     | Auto-selects **last 12 months**, dynamic filters, correct totals |
| Caching                    | âœ…     | LocMem + per-user keys; manual â€œClear cacheâ€ button |
| Recurring transactions     | ðŸš§     | Model done; scheduling via Celery next |
| Multi-currency + FX        | ðŸš§     | Currency table ready; rates & conversions in backlog |
| Supabase / Looker reports  | âœ…     | JWT + PostgREST proxy ready for embed dashboards |

---

## Financialâ€‘metric calculations

> **Goal:** separate real cashâ€‘flow *expenses* from investment market swings while keeping investment returns measurable.

| Term | Definition |
| ---- | ---------- |
| **Saving opening balance (month n)** | Sum of all **saving**â€‘type account balances at `00:00` on dayÂ 1 of month *n*. |
| **Saving opening balance (month n + 1)** | Same accounts, `00:00` on dayÂ 1 of month *n + 1*. |
| **Income (month n)** | Sum of transactions with `type = "income"` during monthÂ *n*. |
| **Invested amount (flow)** | Sum of all transactions with `type = "investimento"`. |
| **Portfolio value (stock)** | Closing/monthly balance of **investment**â€‘type accounts (market value of held assets). |

### 1 â€“ Monthly Expenses  

To ignore unrealised P/L on investments and focus purely on cash outflow:

```
Expenses(n) = Saving_open(n)  â€“  Saving_open(n+1)  +  Income(n)
```

### 2 â€“ Investments  

```
Invested (flow) = Î£ transactions(type = "investimento")
Portfolio value (stock) = balance of investment accounts at month end
```

### 3 â€“ Profitability  

Use **TWR** (timeâ€‘weighted return) or **IRR**:

* Cash flows  â†’ Invested amounts  
* Start / end â†’ Portfolio value for each month  

### 4 â€“ Key points  

* Separating **saving** vs **investment** avoids market noise in expense tracking.  
* Only **real flows** (deposits, withdrawals, asset purchases) impact *Expenses* or *Invested amount*.  
* Unrealised gains/losses influence **Profitability**, not **Expenses**.

---

## Data model & taxonomy

* `AccountType` â€“ `"saving"` | `"investment"` | `"credit"` | ...  
* `Transaction` â€“ `type`, `currency`, `amount`, `date`, `tags` (m2m)  
* `AccountBalance` â€“ monthly snapshot linked to `DatePeriod`  
* `DatePeriod` â€“ unique `(year, month)` rows created on demand  

Full schema diagram lives in [`core/mermaidchart.md`](./mermaidchart.md).

---

## CLI / management commands

| Command | Description |
| ------- | ----------- |
| `import_transactions_xlsx <file>` | Import XLSX with Date Â· Type Â· Amount Â· Category Â· Tags Â· Account |
| `account_balance_import_xlsx <file>` | Fast chunked import of monthly balances |
| `clear_tx_cache` | Remove cached DataFrames |
| `recalc_dashboard_kpis` (coming) | Pre-compute KPIs overnight |

---

## Roadmap
* Recurring-transaction scheduler  
* Automatic FX conversion  
* Celery + Flower for background jobs  
* Docker compose for production

---

## Contributing

PRs & issues welcomeâ€”follow [Conventional Commits](https://www.conventionalcommits.org/) and run:

```bash
pre-commit run --all-files
pytest
```

---

## Licence

MIT Â©Â NunoÂ Veiga,Â 2025
